\documentclass[notheorems]{beamer}
\usetheme{Lab2C}
\usepackage{graphicx}
\usepackage{array}
\usepackage{subcaption}
\usepackage{listings}
\usepackage{color}
\usepackage{algorithmic}

\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\lstset{
numbers=left,
numbersep=5pt,
numberstyle=\tiny\color{mygray}
}

\newif\ifbeamer
\beamertrue

\title{Ising model and its application in community detection}
\author{Feng Zhao\inst{1} \and Min Ye\inst{2}\and Shao-Lun Huang\inst{3}}
\institute{\inst{1}Dept. of Electronic Engineering, Tsinghua University
	\and \inst{2}Tsinghua-Berkeley Shenzhen Institute, Tsinghua University }
\date{\today}
\begin{document}
\begin{frame}
	\titlepage
\end{frame}
\section*{Outline}
\begin{frame}
	\tableofcontents
\end{frame}

\section{Background}
\subsection{Ising model}
\begin{frame}
\frametitle{Ising model}
	\begin{columns}
		\column{5cm}
		\begin{figure}
			\includegraphics[width=3cm]{ernst_ising.jpeg}
			\caption{Ernst Ising, German physicist}
		\end{figure}
		\column{5cm}
	In statistical physics, Ising model refers to the magnetic spins that can be in one of two states (+1 or -1).
	
	$T_c$: critical temperature.
	
	\end{columns}
\begin{figure}
	\centering
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=0.7\textwidth]{Tlarge.pdf}
		\caption{$T>T_c$, random spins}
	\end{subfigure}~
	\begin{subfigure}{0.4\textwidth}
		\includegraphics[width=0.65\textwidth]{Tsmall.pdf}
		\caption{$T<T_c$, spins align}
	\end{subfigure}
\end{figure}
\end{frame}
\begin{frame}
\frametitle{Canonical ensemble}
\begin{columns}
	\column{0.5\textwidth}
The distribution of particles:
\begin{equation*}
P(\sigma = \bar{\sigma}) = \frac{1}{Z} \exp(-\beta H(\bar{\sigma}))
\end{equation*}
\begin{itemize}
	\item $Z$: partition function
	\item $\beta$: inverse temperature
	\item $H$: Hamiltonian energy
	\item $\sigma \in \{\pm 1\}^n$: particle state 
\end{itemize}
	\column{0.5\textwidth}
	\begin{tabular}{ccc}
		No & Micro state & Macro state ($H$) \\
		1 & $\uparrow\uparrow\uparrow$ & -3 \\
		2 & $\uparrow\uparrow\downarrow$ & 1 \\
		3 & $\uparrow\downarrow\uparrow$ & 1 \\
		4 & $\downarrow\uparrow\uparrow$ & 1 \\
		5 & $\uparrow\downarrow\downarrow$ & 1 \\
6 & $\downarrow\uparrow\downarrow$ & 1 \\
7 & $\downarrow\downarrow\uparrow$ & 1 \\
8 & $\downarrow\downarrow\downarrow$ & -3 \\
	\end{tabular}
\end{columns}
\begin{block}{Hamiltonian for Ising model}
	Given a graph $G(V, E)$,
	\begin{equation*}
	H(\sigma) = -\sum_{\{i,j\} \in E(G)} \sigma_i \cdot \sigma_j
	\end{equation*}

\end{block}

\end{frame}
\begin{frame}
\frametitle{Square-lattice Ising model}	
\begin{block}{spontaneous magnetization}
	$M = \frac{1}{N} \sum_{i=1}^N \sigma_i$: spontaneous magnetization for $N\to \infty$:
	\begin{enumerate}
		\item $T< T_c$, $M>0$, spontaneous magnetization exists;
		\item $T> T_c$, $M=0$, no spontaneous magnetization.
	\end{enumerate}
\end{block}
\begin{figure}
	\centering
	\begin{subfigure}{0.45\textwidth}
		\includegraphics[width=\textwidth]{square-lattice.png}
		\caption{square lattice}
	\end{subfigure}~
	\begin{subfigure}{0.53\textwidth}
		\includegraphics[width=\textwidth]{monte-carlo-ising-6.png}
		\caption{Simulation result}
	\end{subfigure}
\end{figure}

\end{frame}


\begin{frame}
\frametitle{Metropolis algorithm}
\begin{block}{Charateristics}
\begin{itemize}
	\item commonly used to simulate Ising model
	\item single-spin-flip dynamics 
	\item stochastic method for optimization
\end{itemize}
\end{block}
	\begin{algorithmic}[1]
	\STATE random initialize $\bar{\sigma}$
	\STATE randomly choosing a new state $\bar{\sigma}'$ by flipping one spin site
	\STATE compute $\Delta H= H(\bar{\sigma}') - H(\bar{\sigma})$
	\IF{$\Delta H < 0$}
	\STATE $\bar{\sigma} \leftarrow \bar{\sigma}'$
	\ELSE
	\STATE with probability $\exp(-\beta \Delta H)$ 
	such that $\bar{\sigma} \leftarrow -\bar{\sigma}'$ 
	\ENDIF
	\STATE repeat 2-8 until convergence
\end{algorithmic}
\end{frame}

\begin{frame}
\subsection{Community Detection}
\frametitle{Community Detection}
\begin{columns}
	\column{0.5\textwidth}
	\begin{figure}
		\includegraphics[width=0.8\textwidth]{cd.png}
	\end{figure}
\column{0.5\textwidth}
Community detection is inferring the group of vertices which are more
densely connected in a graph
\end{columns}
\begin{columns}
	\column{0.33\textwidth}
	\begin{figure}
		\includegraphics[width=\textwidth]{benno2t.pdf}
	\end{figure}
	\column{0.05\textwidth}
	$\Rightarrow$
	\column{0.5\textwidth}
	\begin{figure}
	\includegraphics[width=\textwidth]{bennot.pdf}
	\end{figure}
\end{columns}


\end{frame}

\begin{frame}
\frametitle{Stochastic Block Model (SBM)}
\begin{block}{Characteristics}
\begin{itemize}
\item a probabilistic model to generate random graph
\item larger probability for the existence of edges within the same community
\item smaller probability for the existence of edges between different communities
\end{itemize}
\end{block}
\begin{columns}
	\column{0.33\textwidth}
		\begin{figure}
		\includegraphics[width=\textwidth]{sbm.png}
	\end{figure}
\column{0.5\textwidth}
$(G,X)\sim \textrm{SBM}(n, k, p, q)$
\begin{itemize}
	\item $n$: the number of nodes
	\item $k$: the number of communities
	\item $p$: probability of connecting within clusters
	\item $q$: probability of connecting across clusters
\end{itemize}
\end{columns}
\end{frame}

\begin{frame}
\frametitle{Exact Recovery of SBM}
\begin{description}
	\item[Observation] random graph $G$, generated by $\textrm{SBM}(n,k,p,q)$;
	\item[Estimator] $\hat{X}(G)$, an algorithm to recover node labels $X$;
	\item[Error Probability] $P_e=P(\hat{X} \neq \pm X)$
\end{description}

\begin{block}{Assumptions}
	\begin{itemize}
	\item Community labels $X$ are symmetric: half $+1$, half $-1$;
	\item $p = a\frac{ \log n}{n}, q = b \frac{ \log n}{n}$;
	\item $n \to \infty$.
	\end{itemize}
\end{block}
\begin{block}{Exact Recovery of SBM}
Under which condition of $a,b$ does $P_e \to 0$?
\end{block}
\end{frame}
\begin{frame}
\frametitle{Phase transition of SBM}
\begin{block}{Exact Recovery of SBM [1]}
	$P_e=P(\hat{X} \neq \pm X)$: exact recovery for $n \to \infty$
	\begin{enumerate}
		\item $\sqrt{a} - \sqrt{b} > \sqrt{2}$, $P_e \to 0$, there exists algorithms to achieve exact recovery;
		\item $\sqrt{a} - \sqrt{b} < \sqrt{2}$, $P_e \to 1$, no algorithm can achieve exact recovery
	\end{enumerate}
\end{block}
{\scriptsize [1]
Abbe, Emmanuel, Afonso S. Bandeira, and Georgina Hall. "Exact recovery in the stochastic block model." IEEE Transactions on Information Theory 62.1 (2015): 471-487.
}
\end{frame}

\section{Stochastic Ising Block Model}
\frame{\tableofcontents[currentsection]}
\begin{frame}
\frametitle{Stochastic Ising Block Model}
\begin{itemize}
\item The Ising model is defined on top of graph generated by SBM.
\begin{equation*}
P_{\sigma | G} = \frac{1}{Z} \exp(-\beta H(\bar{\sigma}))
\end{equation*}
\item The Hamiltonian energy is compensated by repelling interaction between nodes without edge connection
\begin{equation*}
H(\sigma) = \frac{p+q}{2}\sum_{\{i,j\} \not\in E(G)} \sigma_i \cdot \sigma_j - \sum_{\{i,j\} \in E(G)} \sigma_i \cdot \sigma_j
\end{equation*}

\end{itemize}
\begin{figure}
%\includegraphics[width=0.8\textwidth]{pic/what-is-devops.jpg}
\end{figure}
Core Components: Build and Deploy (CICD)
\end{frame}

\begin{frame}
\frametitle{Cloud DevOps service provider}

\begin{table}
\caption{Comparison of Cloud DevOps provider (until 2020)}
\label{table}
\small
\begin{tabular}{|@{\hspace{0.1em}}m{0.9cm}|@{\hspace{0.1em}}>{\centering}m{0.9cm}@{\hspace{0.9em}}|@{	\hspace{-0.1em}}>{\centering}m{0.9cm}|@{\hspace{0.2em}}>{\centering}m{0.8cm}|>{\centering}m{0.8cm}|>{\centering}m{1.0cm}|c|}
\hline
& 
{\scriptsize AppVeyor }& 
 {\scriptsize Azure pipelines} & {\scriptsize CircleCI } &  {\scriptsize GitLab CICD} & {\scriptsize GitHub Action}  & {\scriptsize Travis} \\
\hline
 {\scriptsize Platform} & {\scriptsize Windows Linux} & All & All & Linux docker & All & All\\
\hline
 {\scriptsize Parallel} & 1 & 10 & 4 & 8 &  20 & 5\\
 \hline
 {\scriptsize  Selfhost } & Y & Y & N & Y & Y & N\\
 \hline
 {\scriptsize Artifact} & N & Y & Y & Y & Y & N\\
 \hline
\end{tabular}
\label{tab1}
\end{table}
\end{frame}

\begin{frame}[fragile]
\frametitle{Choosing Environment for Agent}
\begin{enumerate}
\item virtual machine or docker container.
\item public cloud service or local runner.
\item programming language and version.
\end{enumerate}

\begin{lstlisting}[caption={environment configuration}, captionpos=b, xleftmargin=.3\textwidth]
os: linux
dist: xenial
language: python
python: 3.6
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
\frametitle{Workflow Principle}
\begin{figure}
\centering
\begin{subfigure}{0.4\textwidth}
%\includegraphics[width=\textwidth]{../principal.pdf}
\caption{How Cloud DevOps works}
\end{subfigure}~
\begin{subfigure}{0.4\textwidth}
%\includegraphics[width=\textwidth]{../workflow.pdf}
\caption{pipelines for scientific experiments}
\end{subfigure}
\end{figure}

\begin{lstlisting}[caption={workflow description}, label={lst:wd}, captionpos=b, xleftmargin=.25\textwidth]
install: 
  - pip install -r requirements.txt
script: # run experiment
  - python main.py
\end{lstlisting}

\end{frame}
\section{Case Studies}
\frame{\tableofcontents[currentsection]}
\subsection{1) Using public agent}
\begin{frame}
\frametitle{1) Using public agent}
\begin{itemize}
\item implementating a triangle counting algorithm in C++
\item deploy the package to Ubuntu PPA
\item run the medium-scale experiment on Travis CI public server
\end{itemize}
Server VM has 2 CPU cores and 7.5 GB memory space.

Our program finishes in 4.3 minutes and consumes 3.1GB memory.
\end{frame}
\subsection{2) Using self-hosted agent}
\begin{frame}
\frametitle{2) Using self-hosted agent}
\begin{itemize}
\item Using OpenMP to parallel the triangle counting algorithms
\item the experiment is run using a computing node with 32 CPUs.
\item the running log is uploaded to server automatically.
\end{itemize}
\begin{figure}
%\includegraphics[width=5cm]{../self-hosted.pdf}
\caption{self-hosted computing cluster connected to DevOps server}
\end{figure}
\end{frame}
\subsection{3) Integrated with other cloud infrastructure}
\begin{frame}
\frametitle{3) Integrated with other cloud infrastructure}
\begin{itemize}
\item plug into a serverless computing experiment
\item replace the private client with public agent
\end{itemize}
\begin{figure}
%\includegraphics[width=0.8\textwidth]{pic/serverless_show.png}
\end{figure}
\end{frame}
\section{Conclusion}
\begin{frame}
\frametitle{Conclusion}
On-going work:
\begin{itemize}
\item Extension of SIBM to multiple community case;
\item connection with other community detection method is explored
\end{itemize}
\begin{figure}
	\includegraphics[width=0.8\textwidth]{overview.pdf}
	\caption{Connection between different parts}
\end{figure}
\end{frame}

\begin{frame}
\frametitle{}
\begin{block}{}
\centering
{\Huge Thank you!}
\end{block}
\end{frame}
\end{document}
