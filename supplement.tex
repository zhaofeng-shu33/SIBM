\documentclass{article}
\input{macros.tex}
\title{Supplementary Material to SIBM with 2 communities}
\author{Feng Zhao}
\begin{document}
\maketitle
In this supplementary material, we give some undocumented proof.
\begin{lemma}\label{lem:ucBA}
Let $\cG_1:=\{G:B_i-A_i<0\text{~for all~}i\in[n]\}$. Suppose $i\neq j$, then $P(B_i-A_i + B_j - A_j= t\log(n)~|~G\in\cG_1)= (1+o(1))P(B_i-A_i + B_j - A_j= t\log(n))$ for all $t<0$ such that $t\log(n)$ is an integer.
\end{lemma}
\begin{lemma}\label{lem:BijG}
\begin{equation} 
E \big[  \exp\big(2\beta (B_i-A_i + B_j - A_j) \big) ~\big|~ G\in\cG_1 \big] 
= (1+o(1)) E \big[  \exp\big(2\beta (B_i-A_i + B_j - A_j) \big) \big] ,
\end{equation}
\end{lemma}
\begin{proof}
First we have
\begin{align}
E \big[  \exp\big(2\beta (B_i-A_i + B_j - A_j) \big) ~\big|~ G\in\cG_1 \big] 
&= \sum_{t=-n}^{-2} P(B_i -A_i + B_j - A_j = t\log n | G \in \cG_1) \exp(2\beta t \log n) \notag \\
\text{ Lemma \ref{lem:ucBA} implies }&= (1+o(1))\sum_{t=-n}^{-2} P(B_i -A_i + B_j - A_j = t\log n) \exp(2\beta t \log n)
\end{align}
On the other hand, we suppose $X_i \neq X_j$ and we decompose $B_j = B'_j + \xi_{ij}, B_i = B'_i + \xi_{ij}$ where $\xi_{ij}$ is an indicator function of $\{i,j\} \in E(G)$. Then $B'_j, B'_i, A_j, A_i, \xi_{ij}$ are independent.
$\xi_{ij} \sim Bern(\frac{b\log n}{n})$.
Then we have
\begin{align*}
E \big[  \exp\big(2\beta (B_i-A_i + B_j - A_j) \big) \big] & = E[\exp(4\beta \xi_{ij})] E[\exp(2\beta (B'_i - A_i)]
E[\exp(2\beta (B'_j - A_j)] \\
& = (1+o(1))E[\exp(2\beta(B'_i - A_i))] E[\exp(2\beta(B'_j - A_j))]
\end{align*}
Using the conclusion that
$$
E[\exp(2\beta(B_i - A_i))] = (1+o(1)) \sum_{t=-n/2}^{-1} P(B_i - A_i = t \log n)E[\exp(2\beta t \log n)]
$$
we have
\begin{align*}
E \big[  \exp\big(2\beta (B_i-A_i + B_j - A_j) \big) \big] & = (1+o(1))
\sum_{t_1=-n/2}^{-1} P(B'_i - A_i = t_1 \log n)E[\exp(2\beta t_1 \log n)] \\
& \cdot
\sum_{t_2=-n/2}^{-1} P(B'_j - A_j = t_2 \log n)E[\exp(2\beta t_2 \log n)] \\
& = (1+o(1))  \sum_{t=-n}^{-2} E[\exp(2\beta t \log n)]\sum_{\substack{t_1 + t_2 = t \\ t_1 < 0, t_2 < 0}} P(B'_i - A_i = t_1 \log n) P(B'_j - A_j = t_2\log n)
\end{align*}
Since 
\begin{align*}
P(B_i -A_i + B_j - A_j = t\log n)
&= \sum_{\substack{t_1 + t_2 + t_3 = t\\ t_3 \in\{0, 1\}}} P(B'_i - A_i = t_1 \log n) P(B'_j - A_j = t_2 \log n) P(2\xi_{ij} = t_3 \log n) \\
&=(1+o(1)) \sum_{t_1 + t_2 = t} P(B'_i - A_i = t_1 \log n) P(B'_j - A_j = t_2 \log n)  \\
\end{align*}
Since $P(G\in G_1) = 1-o(1)$, the above summation can be further restricted to $t_1 < 0, t_2 < 0$. Thus Lemma \ref{lem:BijG} follows. 
\end{proof}
\begin{lemma}\label{lem:post_independent}
	Let $p_{ij}=\Pr(\{\{i,j\} \in E(G) \})$ be the prior probability, which equals $\frac{a\log n}{n}$ or $\frac{b\log n}{n}$ depending on $X$.
	The event $\{\{i,j\} \in E(G) \}$ are independent given $\sigma$ and the posterior probability is
	\begin{equation}
	\Pr(\{\{i,j\} \in E(G) \} | \sigma) = \frac{c p_{ij} }{1-p_{ij} + cp_{ij}} \text{ where  } c= \exp\Big((\beta + \frac{\alpha \log n}{n} ) I(\bar{\sigma}_i, \bar{\sigma}_j) \Big)
	\end{equation}
\end{lemma}
\begin{proof}
	Let $Y_{ij}$ be a Bernoulli random variable with $\Pr(Y_{ij} = 1) = \Pr(\{\{i,j\} \in E(G)\}) = p_{ij}$. $Y_{ij}$ represents whether there is an edge between node $i$ and $j$.
	The prior distribution for $Y:=\{Y_{ij}\}$ can be written as:
	$$
	\Pr(Y) = \prod_{i,j} p_{ij}^{y_{ij}} (1-p_{ij})^{1-y_{ij}}
	$$ 
	Using the conditional distribution for $\sigma|G$, the posterior probability for $Y| \sigma$ can be written as
	$$
	\Pr(Y|\sigma) = C\prod_{ij} \exp((\beta + \frac{\alpha \log n}{n})I(\bar{\sigma_i}, \bar{\sigma_j} )y_{ij}) \Pr(Y)
	$$
	where $C$ is a constant irrelevant with $Y$.
	We can see from the joint distribution of $Y|\sigma$ that $Y_{ij} | \sigma$ are independent and each marginal distribution has the following form:
	$$
	\Pr(Y_{ij} | \sigma) = C_{ij} \exp((\beta + \frac{\alpha \log n}{n})I(\bar{\sigma_i}, \bar{\sigma_j} )y_{ij}) p_{ij}^{y_{ij}} (1-p_{ij})^{1-y_{ij}}
	$$
	Using the normalization condition for $Y_{ij} | \sigma $, we can compute $C_{ij} = \frac{1}{1-p_{ij} + p_{ij}c}$. From $\Pr(\{\{i,j\} \in E(G) \} | \sigma) =\Pr(Y_{ij}=1|\sigma)$ the proof is complete.
\end{proof}

\begin{lemma} \label{lm:qq}
	Let 
	$$
	(X,G,\{\sigma^{(1)},\dots,\sigma^{(m)}\})\sim \SIBM(n,a\log(n)/n, b\log(n)/n,\alpha,\beta, m) .
	$$
	If there is a pair $i,i'\in[n]$ satisfying the following two conditions: (1) $\sigma_i^{(j)}=\sigma_{i'}^{(j)}$ for all $j\in[m]$ and (2) $X_i=-X_{i'}$, then it is not possible to distinguish the case $X_i=-X_{i'}=1$ from the case $X_i=-X_{i'}=-1$. In other words, conditioning on the samples, the posterior probability of the ground truth being $X$ is the same as that of the ground truth being $X^{(\sim\{i,i'\})}$, i.e.
	\begin{align}
	&P(X_i=1,X_j = \bar{X}_j \in \{\pm 1\},j \neq i,i' | X_i = -X_{i'}, \sigma_i^{(j)}=\sigma_{i'}^{(j)}, j\in[m]) \notag\\
	&  = P(X_i=-1,X_j = \bar{X}_j \in \{\pm 1\},j \neq i,i' | X_i = -X_{i'}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m])
	\end{align}
	Notice the condition $\sigma_i^{(j)}=\sigma_{i'}^{(j)}, j\in[m]$ is actually saying that we have already known $m$ samples $\sigma = \sigma^{(j)}$ and
	it happens that the $i$-th coordinate and $i'$-th coordinate of each sample are the same. 
\end{lemma}
\begin{proof}
Let $\bar{X}_i = 1, \bar{X}_{i'}=-1$ We only need to show
\begin{equation}\label{eq:12}
P(X=\bar{X}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m]) = P(X=\bar{X}^{\sim(i,i')}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m])
\end{equation}
Let $\cG_{[n]}$ be the set consisting of all the graphs with vertex set $[n]$.
A permutation $\pi\in S_n$ on the vertex set $[n]$ also induces a permutation on $\cG_{[n]}$: For $G\in\cG_{[n]}$, define the graph $\pi(G)\in\cG_{[n]}$ as the graph with the edge set $E(\pi(G))$ satisfying that $\{\pi(i),\pi(j)\}\in E(\pi(G))$ if and only if $\{i,j\}\in E(G)$.
It is easy to see that for any $\pi\in S_n$ and any $G\in\cG_{[n]}$,
$$
Z_G(\alpha,\beta)
=Z_{\pi(G)}(\alpha,\beta),
$$
%where $Z_G(\alpha,\beta)$ is defined in \eqref{eq:zg}.
We define a permutation $\pi$ such that $\pi(i) = i', \pi(i') = i$ and $\pi(j) = j$ for $j\neq i,i'$.
We can check that $\bar{X}_i=\bar{X}^{\sim(i,i')}_{\pi(i)}$ for all $i\in[n]$ holds.
$$
P_{\SSBM}(G  | X = \bar{X})=P_{\SSBM}(\pi(G) | X = \bar{X}^{\sim(i,i')})  ,
$$

Using the Markov property of $X \to G \to \sigma$, we have
\begin{align*}
P(X=\bar{X}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m]) & = \sum_{G \in \cG_{[n]}} P(X=\bar{X}) P_{\SSBM}(G  | X = \bar{X})\prod_{j=1}^m P_{\sigma | G}(\sigma =\sigma^{(j)})\\
\end{align*}
If we can show that 
\begin{equation}\label{eq:sigmaEqual}
P_{\sigma | G}(\sigma =\sigma^{(j)}) = P_{\sigma | \pi(G)}(\sigma =\sigma^{(j)})
\end{equation}
Then 
\begin{align*}
P(X=\bar{X}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m]) & = \sum_{G \in \cG_{[n]}} P(X=\bar{X}^{\sim(i,i')}) P_{\SSBM}(\pi(G)  | X = \bar{X}^{\sim(i,i')})\prod_{j=1}^m P_{\sigma | \pi(G)}(\sigma =\sigma^{(j)})\\
& = P(\bar{X}^{\sim(i,i')}, \sigma_i^{(j)} = \sigma_{i'}^{(j)}, j\in[m])
\end{align*}
The key to prove Equation \eqref{eq:sigmaEqual} lies at the property $\sigma^{(j)}_i = \sigma^{(j)}_{i'}$.
Let $c_G(\sigma, i,j) = (\beta + \frac{\alpha \log n}{n})\sigma_i \sigma_j \mathbbm{1}[\{i,j\}\in E(G)]  - \frac{\alpha \log n}{n}$
and $C_G(\sigma) = \frac{1}{Z_G(\alpha, \beta)}\exp(\sum_{j_1, j_2 \not\in \{i,i'\}} c_G(\sigma, j_1, j_2) - c_G(\sigma, i,i'))$
\begin{align*}
P_{\sigma | G}(\sigma =\sigma^{(j)}) & = C_G(\sigma^{(j)})\exp(\sum_{s=1}^n c_G(\sigma^{(j)}, i, s)
+ \sum_{s=1}^n c_G(\sigma^{(j)}, i',s) ) \\
& = C_{\pi(G)}(\sigma^{(j)})\exp(\sum_{j=s}^n c_G(\sigma^{(j)}, i, s)
+ \sum_{s=1}^n c_G(\sigma^{(j)}, i',s) ) \\
& = C_{\pi(G)}(\sigma^{(j)})\exp(\sum_{s=1}^n c_{\pi(G)}(\sigma^{(j)}, i', s)+ \sum_{s=1}^n c_{\pi(G)}(\sigma^{(j)}, i, s) ) \\
& = C_{\pi(G)}(\sigma^{(j)})\exp(\sum_{s=1}^n c_{\pi(G)}(\sigma^{(j)}, \pi(i), s) + \sum_{s=1}^n c_{\pi(G)}(\sigma^{(j)}, \pi(i'), s) ) \\
& = P_{\sigma | \pi(G)}(\sigma =\sigma^{(j)})
\end{align*}
\end{proof}
\begin{lemma}
	Let $m,k$ be integers and $k\geq 2, m\geq 1$, then
	\begin{align}
	m - \lfloor {m + 1 \over k} \rfloor & \leq  \lfloor {k - 1 \over k}(m+1) \rfloor \label{eq:m1} \\
	(k-1) {m + 1 \over k}& \leq  \lfloor {k-1 \over k}(m+1) \rfloor \label{eq:m2}
	\end{align}
\end{lemma}
\begin{proof}
	For Eq. \eqref{eq:m2} we only need to show
	\begin{equation}\label{eq:m22}
	n \lfloor a \rfloor \leq \lfloor n a \rfloor
	\end{equation}
	for positive integer $n$ and positive real number $a$.
	
	Let $a = \lfloor a \rfloor + \{ a \}$, Eq. \eqref{eq:m22} is equivalent with
	$n \lfloor a \rfloor \leq \lfloor n \{ a \} \rfloor + n \lfloor a \rfloor$, which is obvious.
	
	For Eq. \eqref{eq:m1} we want to show 
	\begin{align*}
     &	m - \lfloor {m + 1 \over k} \rfloor  \leq  (k-1)\lfloor {m + 1 \over k} \rfloor + \lfloor (k-1) \{ {m + 1 \over k }\}\rfloor \\
     \iff & m - k \lfloor {m + 1 \over k} \rfloor \leq \lfloor (k-1) \{ {m + 1 \over k }\}\rfloor \\
     \iff & m - k ({m + 1 \over k} - \{ {m+1 \over k }\}) \leq \lfloor (k-1) \{ {m + 1 \over k }\}\rfloor  \\
     \iff & k \{ {m+1 \over k }\} - 1 \leq \lfloor (k-1) \{ {m + 1 \over k }\}\rfloor  \\
	\end{align*}
	Since $k \{ {m+1 \over k }\}$ is an integer, the above Equation is further equivalent with
	$$
	- 1 \leq \lfloor - \{ {m + 1 \over k }\}\rfloor  
	$$
	which is obvious by the definition of the fractional part of a number.
\end{proof}
\begin{lemma}
Let $m,k$ be integers and $k\geq 2, m\geq 1$. then
$\lfloor {(k-1)(m+1) \over k} \rfloor < {\beta^\ast \over \beta} \iff m < \frac{k}{k-1} \lfloor \frac{\beta^\ast}{\beta} \rfloor + \frac{1}{k-1}$
if $\beta^\ast \over \beta$ is not an integer
while
$\lfloor {(k-1)(m+1) \over k} \rfloor < {\beta^\ast \over \beta} \iff  m < \frac{k}{k-1}\lfloor \frac{\beta^\ast}{\beta} \rfloor -1 $
if $\beta^\ast \over \beta$ is an integer.
\end{lemma}
\begin{proof}
If $\beta^\ast \over \beta$ is not an integer, then
\begin{align*}
& \lfloor {(k-1)(m+1) \over k} \rfloor < {\beta^\ast \over \beta}  \\
\iff & {(k-1)(m+1) \over k} < \lfloor{\beta^\ast \over \beta}\rfloor + 1 \\
\iff & m < \frac{k}{k-1} \lfloor \frac{\beta^\ast}{\beta} \rfloor + \frac{1}{k-1}
\end{align*}
If  $\beta^\ast \over \beta$ is an integer, then
\begin{align*}
& \lfloor {(k-1)(m+1) \over k} \rfloor < {\beta^\ast \over \beta}  \\
\iff & {(k-1)(m+1) \over k} < \lfloor{\beta^\ast \over \beta}\rfloor \\
\iff & m < \frac{k}{k-1} \lfloor \frac{\beta^\ast}{\beta} \rfloor -1
\end{align*}
\end{proof}
\end{document}
